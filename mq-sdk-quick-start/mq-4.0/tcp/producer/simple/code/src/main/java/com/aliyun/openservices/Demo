package com.aliyun.openservices;

import java.util.Date;
import java.util.Properties;
import com.aliyun.openservices.ons.api.Message;
import com.aliyun.openservices.ons.api.ONSFactory;
import com.aliyun.openservices.ons.api.Producer;
import com.aliyun.openservices.ons.api.PropertyKeyConst;
import com.aliyun.openservices.ons.api.SendResult;
import com.aliyun.openservices.ons.api.exception.ONSClientException;

public class Demo {

    // 使用必读！！！！
    // 您需要将阿里云密钥信息填写到代码中的 ACCESS_KEY 和 SECRET_KEY 的变量中。
    // 如果您还没有密钥，您可以在 RAM 控制台中创建密钥。https://ram.console.aliyun.com/manage/ak
    // 注意：此密钥必须具有消息发送的权限，否则将无法完成消息发送。https://help.aliyun.com/document_detail/112711.html
    // Please replace the ACCESS_KEY and SECRET_KEY with your Aliyun AK and SK.

    public static final String ACCESS_KEY = "YOUR_ALIYUN_ACCESS_KEY_ID";
    public static final String SECRET_KEY = "YOUR_ALIYUN_ACCESS_KEY_SECRET";

    public static final String NAMESRV_ADDR = "${NAMESRV_ADDR}";
    public static final String TOPIC = "${TOPIC}";
    public static final String TAG = "${TAG}";
    public static final String KEY = "${KEY}";
    public static final String BODY = "${BODY}";

    public static void main(String[] args) {
        Properties producerProperties = new Properties();
        producerProperties.setProperty(PropertyKeyConst.AccessKey, ACCESS_KEY);
        producerProperties.setProperty(PropertyKeyConst.SecretKey, SECRET_KEY);
        producerProperties.setProperty(PropertyKeyConst.NAMESRV_ADDR, NAMESRV_ADDR);
        Producer producer = ONSFactory.createProducer(producerProperties);
        producer.start();
        System.out.println("Producer Started");

        for (int i = 0; i < 10; i++) {
            Message message = new Message(TOPIC, TAG, BODY.getBytes());
            if (!KEY.isEmpty()) {
                message.setKey(KEY);
            }
            try {
                SendResult sendResult = producer.send(message);
                assert sendResult != null;
                System.out.println(new Date() + " Send mq message success! Topic is:" + TOPIC + " msgId is: "
                        + sendResult.getMessageId());
            } catch (ONSClientException e) {
                System.out.println(new Date() + " Send mq message failed! Topic is:" + TOPIC);
                e.printStackTrace();
            }
        }
    }
}
